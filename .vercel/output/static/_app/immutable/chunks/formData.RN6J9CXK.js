import{U as rt,N as kt,P as It,e as Ot,f as it,H as Pt,h as Le,g as ce,w as Y,c as jt,r as ke,j as Dt,i as Rt,b as Ie}from"./entry.BF9yKNlN.js";import{p as de,n as Ke}from"./stores.yKo6NxPo.js";import{o as we}from"./index-client.fGmTI9vP.js";import{e as Ct}from"./forms.D059JiKi.js";import{aA as je}from"./runtime.DjgYXsSk.js";const Nt=!0;class Oe extends Error{constructor(i,a){super(i),this.name="DevalueError",this.path=a.join("")}}function Xe(n){return Object(n)!==n}const Lt=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Vt(n){const i=Object.getPrototypeOf(n);return i===Object.prototype||i===null||Object.getOwnPropertyNames(i).sort().join("\0")===Lt}function xt(n){return Object.prototype.toString.call(n).slice(8,-1)}function $t(n){switch(n){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return n<" "?`\\u${n.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function oe(n){let i="",a=0;const t=n.length;for(let l=0;l<t;l+=1){const u=n[l],s=$t(u);s&&(i+=n.slice(a,l)+s,a=l+1)}return`"${a===0?n:i+n.slice(a)}"`}function Ut(n){return Object.getOwnPropertySymbols(n).filter(i=>Object.getOwnPropertyDescriptor(n,i).enumerable)}function Ht(n,i){const a=[],t=new Map,l=[];for(const d in i)l.push({key:d,fn:i[d]});const u=[];let s=0;function m(d){if(typeof d=="function")throw new Oe("Cannot stringify a function",u);if(t.has(d))return t.get(d);if(d===void 0)return rt;if(Number.isNaN(d))return kt;if(d===1/0)return It;if(d===-1/0)return Ot;if(d===0&&1/d<0)return it;const E=s++;t.set(d,E);for(const{key:x,fn:j}of l){const J=j(d);if(J)return a[E]=`["${x}",${m(J)}]`,E}let h="";if(Xe(d))h=Pe(d);else switch(xt(d)){case"Number":case"String":case"Boolean":h=`["Object",${Pe(d)}]`;break;case"BigInt":h=`["BigInt",${d}]`;break;case"Date":h=`["Date","${!isNaN(d.getDate())?d.toISOString():""}"]`;break;case"RegExp":const{source:J,flags:K}=d;h=K?`["RegExp",${oe(J)},"${K}"]`:`["RegExp",${oe(J)}]`;break;case"Array":h="[";for(let b=0;b<d.length;b+=1)b>0&&(h+=","),b in d?(u.push(`[${b}]`),h+=m(d[b]),u.pop()):h+=Pt;h+="]";break;case"Set":h='["Set"';for(const b of d)h+=`,${m(b)}`;h+="]";break;case"Map":h='["Map"';for(const[b,$]of d)u.push(`.get(${Xe(b)?Pe(b):"..."})`),h+=`,${m(b)},${m($)}`,u.pop();h+="]";break;default:if(!Vt(d))throw new Oe("Cannot stringify arbitrary non-POJOs",u);if(Ut(d).length>0)throw new Oe("Cannot stringify POJOs with symbolic keys",u);if(Object.getPrototypeOf(d)===null){h='["null"';for(const b in d)u.push(`.${b}`),h+=`,${oe(b)},${m(d[b])}`,u.pop();h+="]"}else{h="{";let b=!1;for(const $ in d)b&&(h+=","),b=!0,u.push(`.${$}`),h+=`${oe($)}:${m(d[$])}`,u.pop();h+="}"}}return a[E]=h,E}const g=m(n);return g<0?`${g}`:`[${a.join(",")}]`}function Pe(n){const i=typeof n;return i==="string"?oe(n):n instanceof String?oe(n.toString()):n===void 0?rt.toString():n===0&&1/n<0?it.toString():i==="bigint"?`["BigInt","${n}"]`:String(n)}const st=Nt;var Bt=me;function me(n){let i=n;var a={}.toString.call(n).slice(8,-1);if(a=="Set")return new Set([...n].map(l=>me(l)));if(a=="Map")return new Map([...n].map(l=>[me(l[0]),me(l[1])]));if(a=="Date")return new Date(n.getTime());if(a=="RegExp")return RegExp(n.source,qt(n));if(a=="Array"||a=="Object"){i=Array.isArray(n)?[]:{};for(var t in n)i[t]=me(n[t])}return i}function qt(n){if(typeof n.source.flags=="string")return n.source.flags;var i=[];return n.global&&i.push("g"),n.ignoreCase&&i.push("i"),n.multiline&&i.push("m"),n.sticky&&i.push("y"),n.unicode&&i.push("u"),i.join("")}function De(n,i,a){return n[i]=a,"skip"}function Yt(n,i){return i.value!==void 0&&typeof i.value!="object"&&i.path.length<n.length}function ee(n,i,a={}){a.modifier||(a.modifier=l=>Yt(i,l)?void 0:l.value);const t=z(n,i,a.modifier);if(t)return a.value===void 0||a.value(t.value)?t:void 0}function z(n,i,a){if(!i.length)return;const t=[i[0]];let l=n;for(;l&&t.length<i.length;){const s=t[t.length-1],m=a?a({parent:l,key:String(s),value:l[s],path:t.map(g=>String(g)),isLeaf:!1,set:g=>De(l,s,g)}):l[s];if(m===void 0)return;l=m,t.push(i[t.length])}if(!l)return;const u=i[i.length-1];return{parent:l,key:String(u),value:l[u],path:i.map(s=>String(s)),isLeaf:!0,set:s=>De(l,u,s)}}function Z(n,i,a=[]){for(const t in n){const l=n[t],u=l===null||typeof l!="object",s={parent:n,key:t,value:l,path:a.concat([t]),isLeaf:u,set:g=>De(n,t,g)},m=i(s);if(m==="abort")return m;if(m==="skip")continue;if(!u){const g=Z(l,i,s.path);if(g==="abort")return g}}}function Gt(n,i){return n===i||n.size===i.size&&[...n].every(a=>i.has(a))}function Ze(n,i){const a=new Map;function t(s,m){return s instanceof Date&&m instanceof Date&&s.getTime()!==m.getTime()||s instanceof Set&&m instanceof Set&&!Gt(s,m)||s instanceof File&&m instanceof File&&s!==m}function l(s){return s instanceof Date||s instanceof Set||s instanceof File}function u(s,m){const g=m?z(m,s.path):void 0;function d(){return a.set(s.path.join(" "),s.path),"skip"}if(l(s.value)&&(!l(g==null?void 0:g.value)||t(s.value,g.value)))return d();s.isLeaf&&(!g||s.value!==g.value)&&d()}return Z(n,s=>u(s,i)),Z(i,s=>u(s,n)),Array.from(a.values())}function W(n,i,a){const t=typeof a=="function";for(const l of i){const u=z(n,l,({parent:s,key:m,value:g})=>((g===void 0||typeof g!="object")&&(s[m]={}),s[m]));u&&(u.parent[u.key]=t?a(l,u):a)}}function ue(n){return n.toString().split(/[[\].]+/).filter(i=>i)}function se(n){return n.reduce((i,a)=>{const t=String(a);return typeof a=="number"||/^\d+$/.test(t)?i+=`[${t}]`:i?i+=`.${t}`:i+=t,i},"")}class M extends Error{constructor(i){super(i),Object.setPrototypeOf(this,M.prototype)}}function Wt(n,i){var l;const a={};function t(u){if("_errors"in a||(a._errors=[]),!Array.isArray(a._errors))if(typeof a._errors=="string")a._errors=[a._errors];else throw new M("Form-level error was not an array.");a._errors.push(u.message)}for(const u of n){if(!u.path||u.path.length==1&&!u.path[0]){t(u);continue}const m=!/^\d$/.test(String(u.path[u.path.length-1]))&&((l=ee(i,u.path.filter(h=>/\D/.test(String(h)))))==null?void 0:l.value),g=z(a,u.path,({value:h,parent:x,key:j})=>(h===void 0&&(x[j]={}),x[j]));if(!g){t(u);continue}const{parent:d,key:E}=g;m?(E in d||(d[E]={}),"_errors"in d[E]?d[E]._errors.push(u.message):d[E]._errors=[u.message]):E in d?d[E].push(u.message):d[E]=[u.message]}return a}function Qe(n,i,a){return a?n:(Z(i,t=>{Array.isArray(t.value)&&t.set(void 0)}),Z(n,t=>{!Array.isArray(t.value)&&t.value!==void 0||W(i,[t.path],t.value)}),i)}function zt(n){return at(n,[])}function at(n,i){return Object.entries(n).filter(([,t])=>t!==void 0).flatMap(([t,l])=>{if(Array.isArray(l)&&l.length>0){const u=i.concat([t]);return{path:se(u),messages:l}}else return at(n[t],i.concat([t]))})}function C(n){return n&&typeof n=="object"?Bt(n):n}function et(n){!n.flashMessage||!st||Re(n)&&(document.cookie=`flash=; Max-Age=0; Path=${n.flashMessage.cookiePath??"/"};`)}function Re(n){return!n.flashMessage||!st?!1:n.syncFlashMessage}const ot="noCustomValidity";async function tt(n,i){"setCustomValidity"in n&&n.setCustomValidity(""),!(ot in n.dataset)&&ut(n,i)}function Jt(n,i){for(const a of n.querySelectorAll("input,select,textarea,button")){if(ot in a.dataset)continue;const t=z(i,ue(a.name));if(ut(a,t==null?void 0:t.value),t!=null&&t.value)return}}function ut(n,i){const a=i&&i.length?i.join(`
`):"";n.setCustomValidity(a),a&&n.reportValidity()}const Kt=(n,i=0)=>{const a=n.getBoundingClientRect();return a.top>=i&&a.left>=0&&a.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&a.right<=(window.innerWidth||document.documentElement.clientWidth)},Xt=(n,i=1.125,a="smooth")=>{const u=n.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*i);window.scrollTo({left:0,top:u,behavior:a})},Zt=["checkbox","radio","range","file"];function nt(n){const i=!!n&&(n instanceof HTMLSelectElement||n instanceof HTMLInputElement&&Zt.includes(n.type)),a=!!n&&n instanceof HTMLSelectElement&&n.multiple,t=!!n&&n instanceof HTMLInputElement&&n.type=="file";return{immediate:i,multiple:a,file:t}}var O;(function(n){n[n.Idle=0]="Idle",n[n.Submitting=1]="Submitting",n[n.Delayed=2]="Delayed",n[n.Timeout=3]="Timeout"})(O||(O={}));const Qt=new Set;function en(n,i,a){let t=O.Idle,l,u;const s=Qt;function m(){g(),E(t!=O.Delayed?O.Submitting:O.Delayed),l=window.setTimeout(()=>{l&&t==O.Submitting&&E(O.Delayed)},a.delayMs),u=window.setTimeout(()=>{u&&t==O.Delayed&&E(O.Timeout)},a.timeoutMs),s.add(g)}function g(){clearTimeout(l),clearTimeout(u),l=u=0,s.delete(g),E(O.Idle)}function d(){s.forEach(b=>b()),s.clear()}function E(b){t=b,i.submitting.set(t>=O.Submitting),i.delayed.set(t>=O.Delayed),i.timeout.set(t>=O.Timeout)}const h=n;function x(b){const $=b.target;a.selectErrorText&&$.select()}function j(){a.selectErrorText&&h.querySelectorAll("input").forEach(b=>{b.addEventListener("invalid",x)})}function J(){a.selectErrorText&&h.querySelectorAll("input").forEach(b=>b.removeEventListener("invalid",x))}const K=n;{j();const b=$=>{$.clearAll?d():g(),$.cancelled||setTimeout(()=>Ce(K,a),1)};return we(()=>{J(),b({cancelled:!0})}),{submitting(){m()},completed:b,scrollToFirstError(){setTimeout(()=>Ce(K,a),1)},isSubmitting:()=>t===O.Submitting||t===O.Delayed}}}const Ce=async(n,i)=>{if(i.scrollToError=="off")return;const a=i.errorSelector;if(!a)return;await je();let t;if(t=n.querySelector(a),!t)return;t=t.querySelector(a)??t;const l=i.stickyNavbar?document.querySelector(i.stickyNavbar):null;typeof i.scrollToError!="string"?t.scrollIntoView(i.scrollToError):Kt(t,(l==null?void 0:l.offsetHeight)??0)||Xt(t,void 0,i.scrollToError);function u(m){return typeof i.autoFocusOnError=="boolean"?i.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(m)}if(!u(navigator.userAgent))return;let s;if(s=t,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(s.tagName)||(s=s.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),s)try{s.focus({preventScroll:!0}),i.selectErrorText&&s.tagName=="INPUT"&&s.select()}catch{}};function Ee(n,i,a){const t=z(n,i,({parent:l,key:u,value:s})=>(s===void 0&&(l[u]=/\D/.test(u)?{}:[]),l[u]));if(t){const l=a(t.value);t.parent[t.key]=l}return n}function tn(n,i,a){const t=n.form,l=ue(i),u=Le(t,s=>{const m=z(s,l);return m==null?void 0:m.value});return{subscribe(...s){const m=u.subscribe(...s);return()=>m()},update(s,m){t.update(g=>Ee(g,l,s),m??a)},set(s,m){t.update(g=>Ee(g,l,()=>s),m??a)}}}function nn(n,i){const a="form"in n;if(!a&&(i==null?void 0:i.taint)!==void 0)throw new M("If options.taint is set, the whole superForm object must be used as a proxy.");return a}function be(n,i,a){const t=ue(i);if(nn(n,a))return tn(n,i,a);const l=Le(n,u=>{const s=z(u,t);return s==null?void 0:s.value});return{subscribe(...u){const s=l.subscribe(...u);return()=>s()},update(u){n.update(s=>Ee(s,t,u))},set(u){n.update(s=>Ee(s,t,()=>u))}}}function Ne(n){let i={};const a=Array.isArray(n);for(const[t,l]of Object.entries(n))!l||typeof l!="object"||(a?i={...i,...Ne(l)}:i[t]=Ne(l));return i}const ve=new WeakMap,ie=new WeakMap,ft=n=>{console.warn("Unhandled error caught by Superforms, use onError event to handle it:",n.result.error)},rn={applyAction:!0,invalidateAll:!0,resetForm:!0,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:!1,onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:ft,dataType:"form",validators:void 0,customValidity:!1,clearOnSubmit:"message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",SPA:void 0,validationMethod:"auto"};function sn(n){return`Duplicate form id's found: "${n}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}let lt=!1;try{SUPERFORMS_LEGACY&&(lt=!0)}catch{}let ae=!1;try{globalThis.STORIES&&(ae=!0)}catch{}function dn(n,i){var Je;let a,t=i??{},l;{if((t.legacy??lt)&&(t.resetForm===void 0&&(t.resetForm=!1),t.taintedMessage===void 0&&(t.taintedMessage=!0)),ae&&t.applyAction===void 0&&(t.applyAction=!1),typeof t.SPA=="string"&&(t.invalidateAll===void 0&&(t.invalidateAll=!1),t.applyAction===void 0&&(t.applyAction=!1)),l=t.validators,t={...rn,...t},(t.SPA===!0||typeof t.SPA=="object")&&t.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add a validation adapter to the validators option, or set it to false to disable this warning."),!n)throw new M("No form data sent to superForm. Make sure the output from superValidate is used (usually data.form) and that it's not null or undefined. Alternatively, an object with default values for the form can also be used, but then constraints won't be available.");d(n)===!1&&(n={id:t.id??Math.random().toString(36).slice(2,10),valid:!1,posted:!1,errors:{},data:n,shape:Ne(n)}),n=n;const e=n.id=t.id??n.id,r=ce(de)??(ae?{}:void 0);if(((Je=t.warnings)==null?void 0:Je.duplicateId)!==!1)if(!ve.has(r))ve.set(r,new Set([e]));else{const o=ve.get(r);o!=null&&o.has(e)?console.warn(sn(e)):o==null||o.add(e)}if(ie.has(n)||ie.set(n,n),a=ie.get(n),n=C(a),we(()=>{var o;St(),yt(),At();for(const f of Object.values(H))f.length=0;(o=ve.get(r))==null||o.delete(e)}),t.dataType!=="json"){const o=(f,c)=>{if(!(!c||typeof c!="object")){if(Array.isArray(c))c.length>0&&o(f,c[0]);else if(!(c instanceof Date)&&!(c instanceof File)&&!(c instanceof FileList))throw new M(`Object found in form field "${f}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}};for(const[f,c]of Object.entries(n.data))o(f,c)}}const u={formId:n.id,form:C(n.data),constraints:n.constraints??{},posted:n.posted,errors:C(n.errors),message:C(n.message),tainted:void 0,valid:n.valid,submitting:!1,shape:n.shape},s=u,m=Y(t.id??n.id);function g(e){return Object.values(e).filter(o=>d(o)!==!1)}function d(e){return!e||typeof e!="object"||!("valid"in e&&"errors"in e&&typeof e.valid=="boolean")?!1:"id"in e&&typeof e.id=="string"?e.id:!1}const E=Y(n.data),h={subscribe:E.subscribe,set:(e,r={})=>{const o=C(e);return qe(o,r.taint??!0),E.set(o)},update:(e,r={})=>E.update(o=>{const f=e(o);return qe(f,r.taint??!0),f})};function x(){return t.SPA===!0||typeof t.SPA=="object"}async function j(e={}){const r=e.formData??s.form;let o={},f;const c=e.adapter??t.validators;if(typeof c=="object"){if(c!=l&&!("jsonSchema"in c))throw new M('Client validation adapter found in options.validators. A full adapter must be used when changing validators dynamically, for example "zod" instead of "zodClient".');if(f=await c.validate(r),!f.success)o=Wt(f.issues,c.shape??s.shape??{});else if(e.recheckValidData!==!1)return j({...e,recheckValidData:!1})}else f={success:!0,data:{}};const p={...s.form,...r,...f.success?f.data:{}};return{valid:f.success,posted:!1,errors:o,data:p,constraints:s.constraints,message:void 0,id:s.formId,shape:s.shape}}function J(e){if(!t.onChange||!e.paths.length||e.type=="blur")return;let r;const o=e.paths.map(se);e.type&&e.paths.length==1&&e.formElement&&e.target instanceof Element?r={path:o[0],paths:o,formElement:e.formElement,target:e.target,set(f,c,p){be({form:h},f,p).set(c)},get(f){return ce(be(h,f))}}:r={paths:o,target:void 0,set(f,c,p){be({form:h},f,p).set(c)},get(f){return ce(be(h,f))}},t.onChange(r)}async function K(e,r=!1,o){e&&(t.validators=="clear"&&U.update(p=>(W(p,e.paths,void 0),p)),setTimeout(()=>J(e)));let f=!1;if(r||(t.validationMethod=="onsubmit"||t.validationMethod=="submit-only"||t.validationMethod=="onblur"&&(e==null?void 0:e.type)=="input"||t.validationMethod=="oninput"&&(e==null?void 0:e.type)=="blur")&&(f=!0),f||!e||!t.validators||t.validators=="clear"){if(e!=null&&e.paths){const p=(e==null?void 0:e.formElement)??fe();p&&b(p,e.paths)}return}const c=await j({adapter:o});return c.valid&&(e.immediate||e.type!="input")&&h.set(c.data,{taint:"ignore"}),await je(),$(c.errors,e,r),c}function b(e,r){const o=new Map;if(t.customValidity&&e)for(const f of r){const c=CSS.escape(se(f)),p=e.querySelector(`[name="${c}"]`);if(p){const k="validationMessage"in p?String(p.validationMessage):"";o.set(f.join("."),{el:p,message:k}),tt(p,void 0)}}return o}async function $(e,r,o){const{type:f,immediate:c,multiple:p,paths:k}=r,B=s.errors,_={};let q=new Map;const N=r.formElement??fe();N&&(q=b(N,r.paths)),Z(e,R=>{if(!Array.isArray(R.value))return;const L=[...R.path];L[L.length-1]=="_errors"&&L.pop();const re=L.join(".");function X(){if(W(_,[R.path],R.value),t.customValidity&&te&&q.has(re)){const{el:y,message:v}=q.get(re);v!=R.value&&(tt(y,R.value),q.clear())}}if(o)return X();const ge=R.path[R.path.length-1]=="_errors",te=R.value&&k.some(y=>ge?L&&y&&L.length>0&&L[0]==y[0]:re==y.join("."));if(te&&t.validationMethod=="oninput"||c&&!p&&te)return X();if(p){const y=ee(ce(U),R.path.slice(0,-1));if(y!=null&&y.value&&typeof(y==null?void 0:y.value)=="object"){for(const v of Object.values(y.value))if(Array.isArray(v))return X()}}const w=ee(B,R.path);if(w&&w.key in w.parent)return X();if(ge){if(t.validationMethod=="oninput"||f=="blur"&&vt(se(R.path.slice(0,-1))))return X()}else if(f=="blur"&&te)return X()}),U.set(_)}function ct(e,r={}){return r.keepFiles&&Z(s.form,o=>{if(!(o.parent instanceof FileList)&&(o.value instanceof File||o.value instanceof FileList)){const f=ee(e,o.path);(!f||!(f.key in f.parent))&&W(e,[o.path],o.value)}}),h.set(e,r)}function pe(e,r){return e&&r&&t.resetForm&&(t.resetForm===!0||t.resetForm())}async function Ve(e,r){e.valid&&r&&pe(e.valid,r)?Se({message:e.message,posted:!0}):he({form:e,untaint:r,keepFiles:!0,skipFormData:t.invalidateAll=="force"}),H.onUpdated.length&&await je();for(const o of H.onUpdated)o({form:e})}function Se(e={}){e.newState&&(a.data={...a.data,...e.newState});const r=C(a);r.data={...r.data,...e.data},e.id!==void 0&&(r.id=e.id),he({form:r,untaint:!0,message:e.message,keepFiles:!1,posted:e.posted,resetted:!0})}async function dt(e){if(e.type=="error")throw new M(`ActionResult of type "${e.type}" cannot be passed to update function.`);if(e.type=="redirect"){pe(!0,!0)&&Se({posted:!0});return}if(typeof e.data!="object")throw new M("Non-object validation data returned from ActionResult.");const r=g(e.data);if(!r.length)throw new M("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const o of r)o.id===s.formId&&await Ve(o,e.status>=200&&e.status<300)}const ne=Y(u.message),Te=Y(u.constraints),_e=Y(u.posted),xe=Y(u.shape),Ae=Y(n.errors),U={subscribe:Ae.subscribe,set(e,r){return Ae.set(Qe(e,s.errors,r==null?void 0:r.force))},update(e,r){return Ae.update(o=>Qe(e(o),s.errors,r==null?void 0:r.force))},clear:()=>U.set({})};let T=null;function mt(e){var r;T&&e&&Object.keys(e).length==1&&((r=e.paths)!=null&&r.length)&&T.target&&T.target instanceof HTMLInputElement&&T.target.type.toLowerCase()=="file"?T.paths=e.paths:T=e,setTimeout(()=>{K(T)},0)}function pt(e,r,o,f,c){T===null&&(T={paths:[]}),T.type=e,T.immediate=r,T.multiple=o,T.formElement=f,T.target=c}function $e(){return(T==null?void 0:T.paths)??[]}function yt(){T=null}const F={defaultMessage:"Leave page? Changes that you made may not be saved.",state:Y(),message:t.taintedMessage,clean:C(n.data),forceRedirection:!1};function Ue(){return t.taintedMessage&&!s.submitting&&!F.forceRedirection&&Be()}function He(e){if(!Ue())return;e.preventDefault(),e.returnValue="";const{taintedMessage:r}=t,f=typeof r=="function"||r===!0?F.defaultMessage:r;return(e||window.event).returnValue=f||F.defaultMessage,f}async function ht(e){if(!Ue())return;const{taintedMessage:r}=t,o=typeof r=="function";if(o&&e.cancel(),e.type==="leave")return;const f=o||r===!0?F.defaultMessage:r;let c;try{c=o?await r():window.confirm(f||F.defaultMessage)}catch{c=!1}if(c&&e.to)try{F.forceRedirection=!0,await Dt(e.to.url,{...e.to.params});return}finally{F.forceRedirection=!1}else!c&&!o&&e.cancel()}function gt(){t.taintedMessage=F.message}function bt(){return F.state}function vt(e){if(!s.tainted)return!1;if(!e)return!!s.tainted;const r=ee(s.tainted,ue(e));return!!r&&r.key in r.parent}function Be(e){if(!arguments.length)return ye(s.tainted);if(typeof e=="boolean")return e;if(typeof e=="object")return ye(e);if(!s.tainted||e===void 0)return!1;const r=ee(s.tainted,ue(e));return ye(r==null?void 0:r.value)}function ye(e){if(!e)return!1;if(typeof e=="object"){for(const r of Object.values(e))if(ye(r))return!0}return e===!0}function qe(e,r){if(r=="ignore")return;const o=Ze(e,s.form),f=Ze(e,F.clean).map(c=>c.join());o.length&&(r=="untaint-all"||r=="untaint-form"?F.state.set(void 0):F.state.update(c=>(c||(c={}),W(c,o,(p,k)=>{if(!f.includes(p.join()))return;const B=z(e,p),_=z(F.clean,p);return B&&_&&B.value===_.value?void 0:r===!0?!0:r==="untaint"?void 0:k.value}),c))),mt({paths:o})}function wt(e,r){F.state.set(e),r&&(F.clean=r)}const Me=Y(!1),Ye=Y(!1),Ge=Y(!1),We=[F.state.subscribe(e=>u.tainted=C(e)),h.subscribe(e=>u.form=C(e)),U.subscribe(e=>u.errors=C(e)),m.subscribe(e=>u.formId=e),Te.subscribe(e=>u.constraints=e),_e.subscribe(e=>u.posted=e),ne.subscribe(e=>u.message=e),Me.subscribe(e=>u.submitting=e),xe.subscribe(e=>u.shape=e)];function Et(e){We.push(e)}function St(){We.forEach(e=>e())}let D;function fe(){return D}function Tt(e){D=document.createElement("form"),D.method="POST",D.action=e,ze(D),document.body.appendChild(D)}function _t(e){D&&(D.action=e)}function At(){D!=null&&D.parentElement&&D.remove(),D=void 0}const Mt=Le(U,e=>e?zt(e):[]);t.taintedMessage=void 0;function he(e){const r=e.form,o=e.message??r.message;if((e.untaint||e.resetted)&&wt(typeof e.untaint=="boolean"?void 0:e.untaint,r.data),e.skipFormData!==!0&&ct(r.data,{taint:"ignore",keepFiles:e.keepFiles}),ne.set(o),e.resetted?U.update(()=>({}),{force:!0}):U.set(r.errors),m.set(r.id),_e.set(e.posted??r.posted),r.constraints&&Te.set(r.constraints),r.shape&&xe.set(r.shape),u.valid=r.valid,t.flashMessage&&Re(t)){const f=t.flashMessage.module.getFlash(de);o&&ce(f)===void 0&&f.set(o)}}const H={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};window.addEventListener("beforeunload",He),we(()=>{window.removeEventListener("beforeunload",He)}),jt(ht),Et(de.subscribe(async e=>{ae&&e===void 0&&(e={status:200});const r=e.status>=200&&e.status<300;if(t.applyAction&&e.form&&typeof e.form=="object"){const o=e.form;if(o.type=="error")return;for(const f of g(o)){const c=ie.has(f);f.id!==s.formId||c||(ie.set(f,f),await Ve(f,r))}}else if(e.data&&typeof e.data=="object")for(const o of g(e.data)){const f=ie.has(o);if(o.id!==s.formId||f)continue;t.invalidateAll==="force"&&(a.data=o.data);const c=pe(!0,!0);he({form:o,untaint:r,keepFiles:!c,resetted:c})}})),typeof t.SPA=="string"&&Tt(t.SPA);function ze(e,r){if(t.SPA!==void 0&&e.method=="get"&&(e.method="post"),typeof t.SPA=="string"?t.SPA.length&&e.action==document.location.href&&(e.action=t.SPA):D=e,r){if(r.onError){if(t.onError==="apply")throw new M('options.onError is set to "apply", cannot add any onError events.');if(r.onError==="apply")throw new M('Cannot add "apply" as onError event in use:enhance.');H.onError.push(r.onError)}r.onResult&&H.onResult.push(r.onResult),r.onSubmit&&H.onSubmit.push(r.onSubmit),r.onUpdate&&H.onUpdate.push(r.onUpdate),r.onUpdated&&H.onUpdated.push(r.onUpdated)}gt();let o;async function f(B){const _=nt(B.target);_.immediate&&!_.file&&await new Promise(q=>setTimeout(q,0)),o=$e(),pt("input",_.immediate,_.multiple,e,B.target??void 0)}async function c(B){if(s.submitting||!o||$e()!=o)return;const _=nt(B.target);_.immediate&&!_.file&&await new Promise(q=>setTimeout(q,0)),K({paths:o,immediate:_.multiple,multiple:_.multiple,type:"blur",formElement:e,target:B.target??void 0}),o=void 0}e.addEventListener("focusout",c),e.addEventListener("input",f),we(()=>{e.removeEventListener("focusout",c),e.removeEventListener("input",f)});const p=en(e,{submitting:Me,delayed:Ye,timeout:Ge},t);let k;return Ct(e,async B=>{let _,q=t.validators;const N={...B,jsonData(w){if(t.dataType!=="json")throw new M("options.dataType must be set to 'json' to use jsonData.");_=w},validators(w){q=w}},R=N.cancel;let L=!1;function re(w){var G;const y={...w,posted:!0},v=y.valid?200:(typeof t.SPA=="boolean"||typeof t.SPA=="string"||(G=t.SPA)==null?void 0:G.failStatus)??400,I={form:y},P=y.valid?{type:"success",status:v,data:I}:{type:"failure",status:v,data:I};setTimeout(()=>te({result:P}),0)}function X(){switch(t.clearOnSubmit){case"errors-and-message":U.clear(),ne.set(void 0);break;case"errors":U.clear();break;case"message":ne.set(void 0);break}}function le(w={resetTimers:!0}){return L=!0,w.resetTimers&&p.isSubmitting()&&p.completed({cancelled:L}),R()}if(N.cancel=le,p.isSubmitting()&&t.multipleSubmits=="prevent")le({resetTimers:!1});else{p.isSubmitting()&&t.multipleSubmits=="abort"&&k&&k.abort(),p.submitting(),k=N.controller;for(const w of H.onSubmit)await w(N)}if(L&&t.flashMessage&&et(t),!L){const w=!x()&&(e.noValidate||(N.submitter instanceof HTMLButtonElement||N.submitter instanceof HTMLInputElement)&&N.submitter.formNoValidate);let y;const v=async()=>await j({adapter:q});if(X(),w||(y=await v(),y.valid||(le({resetTimers:!1}),re(y))),!L){t.flashMessage&&(t.clearOnSubmit=="errors-and-message"||t.clearOnSubmit=="message")&&Re(t)&&t.flashMessage.module.getFlash(de).set(void 0);const I="formData"in N?N.formData:N.data;if(o=void 0,x())y||(y=await v()),le({resetTimers:!1}),re(y);else if(t.dataType==="json"){y||(y=await v());const P=C(_??y.data);Z(P,A=>{if(A.value instanceof File){const S="__superform_file_"+se(A.path);return I.append(S,A.value),A.set(void 0)}else if(Array.isArray(A.value)&&A.value.length&&A.value.every(S=>S instanceof File)){const S="__superform_files_"+se(A.path);for(const V of A.value)I.append(S,V);return A.set(void 0)}}),Object.keys(P).forEach(A=>{typeof I.get(A)=="string"&&I.delete(A)});const G=ge(Ht(P),t.jsonChunkSize??5e5);for(const A of G)I.append("__superform_json",A)}if(!I.has("__superform_id")){const P=s.formId;P!==void 0&&I.set("__superform_id",P)}typeof t.SPA=="string"&&_t(t.SPA)}}function ge(w,y){const v=Math.ceil(w.length/y),I=new Array(v);for(let P=0,G=0;P<v;++P,G+=y)I[P]=w.substring(G,G+y);return I}async function te(w){var A;let y=!1;k=null;let v="type"in w.result&&"status"in w.result?w.result:{type:"error",status:parseInt(String(w.result.status))||500,error:w.result.error instanceof Error?w.result.error:w.result};const I=()=>y=!0,P={result:v,formEl:e,formElement:e,cancel:I},G=ae||!x()?()=>{}:Ke.subscribe(S=>{var V,Q;!S||((V=S.from)==null?void 0:V.route.id)===((Q=S.to)==null?void 0:Q.route.id)||I()});for(const S of H.onResult)await S(P);if(v=P.result,!y){if((v.type==="success"||v.type=="failure")&&v.data){const S=g(v.data);if(!S.length)throw new M("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const V of S){if(V.id!==s.formId)continue;const Q={form:V,formEl:e,formElement:e,cancel:()=>y=!0,result:v};for(const Fe of H.onUpdate)await Fe(Q);v=Q.result,y||(t.customValidity&&Jt(e,Q.form.errors),pe(Q.form.valid,v.type=="success")&&Q.formElement.querySelectorAll('input[type="file"]').forEach(Fe=>Fe.value=""))}}if(!y){if(v.type!=="error")v.type==="success"&&t.invalidateAll&&await Rt(),t.applyAction?await Ie(v):await dt(v);else{if(t.applyAction)if(t.onError=="apply")await Ie(v);else{const S={type:"failure",status:Math.floor(v.status||500),data:v};await Ie(S)}if(t.onError!=="apply"){const S={result:v,message:ne};for(const V of H.onError)V!=="apply"&&(V!=ft||!((A=t.flashMessage)!=null&&A.onError))&&await V(S)}}t.flashMessage&&v.type=="error"&&t.flashMessage.onError&&await t.flashMessage.onError({result:v,flashMessage:t.flashMessage.module.getFlash(de)})}}if(y&&t.flashMessage&&et(t),y||v.type!="redirect")p.completed({cancelled:y});else if(ae)p.completed({cancelled:y,clearAll:!0});else{const S=Ke.subscribe(V=>{V||(setTimeout(()=>{try{S&&S()}catch{}}),p.isSubmitting()&&p.completed({cancelled:y,clearAll:!0}))})}G()}return te})}function Ft(e){const r=[];if(Z(e,f=>{if(f.value instanceof File)return r.push(f.path),"skip";if(Array.isArray(f.value)&&f.value.length&&f.value.every(c=>c instanceof File))return r.push(f.path),"skip"}),!r.length)return{data:e,paths:r};const o=C(e);return W(o,r,f=>{var c;return(c=ee(a.data,f))==null?void 0:c.value}),{data:o,paths:r}}return{form:h,formId:m,errors:U,message:ne,constraints:Te,tainted:bt(),submitting:ke(Me),delayed:ke(Ye),timeout:ke(Ge),options:t,capture(){const{data:e,paths:r}=Ft(s.form);let o=s.tainted;return r.length&&(o=C(o)??{},W(o,r,!1)),{valid:s.valid,posted:s.posted,errors:s.errors,data:e,constraints:s.constraints,message:s.message,id:s.formId,tainted:o,shape:s.shape}},restore:e=>{he({form:e,untaint:e.tainted??!0})},async validate(e,r={}){if(!t.validators)throw new M("options.validators must be set to use the validate method.");r.update===void 0&&(r.update=!0),r.taint===void 0&&(r.taint=!1),typeof r.errors=="string"&&(r.errors=[r.errors]);let o;const f=ue(e);"value"in r?r.update===!0||r.update==="value"?(h.update(k=>(W(k,[f],r.value),k),{taint:r.taint}),o=s.form):(o=C(s.form),W(o,[f],r.value)):o=s.form;const c=await j({formData:o}),p=ee(c.errors,f);return p&&p.value&&r.errors&&(p.value=r.errors),(r.update===!0||r.update=="errors")&&U.update(k=>(W(k,[f],p==null?void 0:p.value),k)),p==null?void 0:p.value},async validateForm(e={}){if(!t.validators&&!e.schema)throw new M("options.validators or the schema option must be set to use the validateForm method.");const r=e.update?await K({paths:[]},!0,e.schema):j({adapter:e.schema}),o=fe();return e.update&&o&&setTimeout(()=>{o&&Ce(o,{...t,scrollToError:e.focusOnError===!1?"off":t.scrollToError})},1),r||j({adapter:e.schema})},allErrors:Mt,posted:_e,reset(e){return Se({message:e!=null&&e.keepMessage?s.message:void 0,data:e==null?void 0:e.data,id:e==null?void 0:e.id,newState:e==null?void 0:e.newState})},submit(e){const r=fe()?fe():e&&e instanceof HTMLElement?e.closest("form"):void 0;if(!r)throw new M("use:enhance must be added to the form to use submit, or pass a HTMLElement inside the form (or the form itself) as an argument.");if(!r.requestSubmit)return r.submit();const o=e&&(e instanceof HTMLButtonElement&&e.type=="submit"||e instanceof HTMLInputElement&&["submit","image"].includes(e.type));r.requestSubmit(o?e:void 0)},isTainted:Be,enhance:ze}}let an=!1;try{SUPERFORMS_LEGACY&&(an=!0)}catch{}export{dn as s};
